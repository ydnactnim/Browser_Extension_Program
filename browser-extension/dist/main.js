document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("geoButton"),e=document.getElementById("submitButton");let n=document.getElementById("cityInput");const o=document.getElementById("suggestions"),a=document.getElementById("error-message");let s;t.addEventListener("click",(()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition((async t=>{const e=t.coords.latitude,o=t.coords.longitude;try{const t=`https://nominatim.openstreetmap.org/reverse?lat=${e}&lon=${o}&format=json`,s=await fetch(t),i=await s.json();if(i&&i.address){const t=i.address.city||i.address.town||i.address.village||"위치 알 수 없음";n.value=t,a.textContent=""}else a.textContent="위치 정보를 찾을 수 없습니다."}catch(t){console.error("역지오코딩 요청 오류:",t),a.textContent="위치 정보를 불러오는데 실패했습니다."}}),(t=>{a.textContent="위치 정보를 허용해주세요.",console.error("위치 추적 오류:",t)})):a.textContent="지오로케이션을 지원하지 않는 브라우저입니다."}));const i=(()=>{let t;return(...e)=>{clearTimeout(t),t=setTimeout((()=>(async t=>{if(t.length<2)return void(o.innerHTML="");const e=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(t)}&format=json&addressdetails=1&limit=5`;try{const t=await fetch(e),a=await t.json();o.innerHTML="",o.style.width=`${n.offsetWidth}px`,a.forEach((t=>{const e=document.createElement("div");e.className="suggestion",e.textContent=t.display_name,e.addEventListener("click",(()=>{n.value=t.display_name,o.innerHTML=""})),o.appendChild(e)}))}catch(t){console.error("자동완성 요청 오류:",t)}})(...e)),300)}})();function r(t,e,n){document.getElementById("main-content").innerHTML=`\n            <div id="today-weather">\n                <h2>${t}의 오늘 날씨</h2>\n                <div id="hourly-weather"></div>\n            </div>\n            <div id="weekly-weather">\n                <h2>${t}의 일주일 날씨</h2>\n                <div id="daily-weather"></div>\n            </div>\n        `,async function(t,e){try{const n=`https://api.open-meteo.com/v1/forecast?latitude=${t}&longitude=${e}&hourly=temperature_2m,weathercode&daily=temperature_2m_max,temperature_2m_min,weathercode&current_weather=true`,o=await fetch(n),a=await o.json(),s={0:"images/clear.svg",1:"images/mostly_clear.svg",2:"images/partly_cloudy.svg",3:"images/cloudy.svg",45:"images/fog.svg",48:"images/sleet.svg",51:"images/ligth_drizzle.svg",53:"images/medium_drizzle.svg",55:"images/heavy_drizzle.svg",61:"images/light_rain.svg",63:"images/medium_rain.svg",65:"images/heavy_rain.svg",80:"images/shower.svg",81:"images/heavy_shower.svg",95:"images/thunderstorm.svg"},i={0:"맑음",1:"대체로 맑음",2:"부분적으로 흐림",3:"흐림",45:"안개",48:"진눈깨비",51:"약한 이슬비",53:"중간 이슬비",55:"강한 이슬비",61:"약한 비",63:"중간 비",65:"강한 비",80:"소나기",81:"강한 소나기",95:"천둥번개"},r=document.getElementById("hourly-weather");a.hourly.weathercode.slice(0,8).forEach(((t,e)=>{const n=(new Date).getHours()+3*e,o=i[t]||"날씨 정보 없음",a=s[t]||"images/default.svg",d=document.createElement("div"),c=document.createElement("img");c.src=a,c.alt=o,c.className="weather-icon",d.appendChild(c),d.innerHTML+=`<strong>${n%24}시</strong><br>${o}`,r.appendChild(d)}));const d=["일요일","월요일","화요일","수요일","목요일","금요일","토요일"];let c=(new Date).getDay();const m=document.getElementById("daily-weather");a.daily.weathercode.forEach(((t,e)=>{const n=d[(c+e)%7],o=i[t]||"날씨 정보 없음",a=s[t]||"images/default.svg",r=document.createElement("div"),l=document.createElement("img");l.src=a,l.alt=o,l.className="weather-icon",r.appendChild(l),r.innerHTML+=`<strong>${n}</strong><br>${o}`,m.appendChild(r)}))}catch(t){console.error("날씨 정보를 가져오는 중 오류 발생:",t)}}(e,n)}function d(){document.getElementById("footer").innerHTML='\n      <button id="changeLocationButton">위치 변경하기</button>\n    ',s=document.getElementById("changeLocationButton"),s.addEventListener("click",(()=>{document.getElementById("main-content").innerHTML='\n        <div id="search-section">\n          <button id="geoButton">현재 위치 사용</button>\n          <input\n            type="text"\n            id="cityInput"\n            placeholder="도시를 검색하세요..."\n            autocomplete="off"\n          />\n          <div id="suggestions"></div>\n          <button id="submitButton">날씨 확인</button>\n        </div>\n      ',a.textContent="",function(){const t=document.getElementById("geoButton"),e=document.getElementById("submitButton");n=document.getElementById("cityInput"),document.getElementById("suggestions"),t.addEventListener("click",(()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition((async t=>{const e=t.coords.latitude,o=t.coords.longitude;try{const t=`https://nominatim.openstreetmap.org/reverse?lat=${e}&lon=${o}&format=json`,s=await fetch(t),i=await s.json();if(i&&i.address){const t=i.address.city||i.address.town||i.address.village||"위치 알 수 없음";n.value=t,a.textContent=""}else a.textContent="위치 정보를 찾을 수 없습니다."}catch(t){console.error("역지오코딩 요청 오류:",t),a.textContent="위치 정보를 불러오는데 실패했습니다."}}),(t=>{a.textContent="위치 정보를 허용해주세요.",console.error("위치 추적 오류:",t)})):a.textContent="지오로케이션을 지원하지 않는 브라우저입니다."})),e.addEventListener("click",(async()=>{const t=n.value.trim();if(t)try{const e=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(t)}&format=json&addressdetails=1&limit=1`,n=await fetch(e),o=await n.json();if(0===o.length)throw new Error("올바른 위치를 찾을 수 없습니다.");const{lat:a,lon:s}=o[0];r(t,a,s),d()}catch(t){a.textContent="위치를 찾을 수 없습니다. 다시 시도해주세요."}else a.textContent="도시 이름을 입력해주세요."})),n.addEventListener("input",(t=>{i(t.target.value)}))}(),document.getElementById("footer").innerHTML='<p id="error-message"></p>'}))}n.addEventListener("input",(t=>{i(t.target.value)})),e.addEventListener("click",(async()=>{const t=n.value.trim();if(t)try{const e=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(t)}&format=json&addressdetails=1&limit=1`,n=await fetch(e),o=await n.json();if(0===o.length)throw new Error("올바른 위치를 찾을 수 없습니다.");const{lat:a,lon:s}=o[0];r(t,a,s),d()}catch(t){a.textContent="위치를 찾을 수 없습니다. 다시 시도해주세요."}else a.textContent="도시 이름을 입력해주세요."}))}));